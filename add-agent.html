<!DOCTYPE html>
<html lang="ru">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Добавить агента — AI Market</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/styles/components/dropdown-multiselect.css">
</head>
<body>
    <div id="root">
        <div class="min-h-screen bg-background">
            <header class="main-header">
                <div class="container header-container">
                    <div class="header-left">
                        <div class="logo">
                            <div class="logo-icon">
                                <img src="images/logos/Bot.svg" alt="AI Market Logo">
                            </div>
                            <div>
                                <h1 class="logo-title">AI Market</h1>
                                <p class="logo-subtitle">Маркетплейс агентов</p>
                            </div>
                        </div>
                        <nav class="main-nav">
                            <a href="index.html">Каталог</a>
                            <a href="#">Как работает</a>
                            <a href="#">Для разработчиков</a>
                            <a href="#">Сообщество</a>
                        </nav>
                    </div>
                    <div class="header-right">
                        <button class="icon-button">
                            <img src="images/icons/ui/ShoppingCart.svg" alt="Shopping Cart">
                        </button>
                        <button class="icon-button" id="user-profile-button">
                            <img src="images/icons/ui/UserProfile.svg" alt="User Profile">
                        </button>
                        <button class="btn btn--primary login-button">Войти/Зарегистрироваться</button>
                        <button class="menu-button">
                            <img src="images/icons/ui/Menu.svg" alt="Menu">
                        </button>
                    </div>
                </div>
            </header>
            <main class="main-content container">
                <div class="back-to-catalog">
                    <a href="index.html" class="btn btn--secondary">&lt; Назад в каталог</a>
                </div>
                <div class="agent-details-page">
                    <div class="agent-details-main">
                        <h1 class="agent-name">Добавить нового агента</h1>
                        <form class="agent-form" autocomplete="off">
                            <div class="form-group">
                                <label class="form-label" for="agentName">Название агента</label>
                                <input class="form-input" type="text" id="agentName" name="agentName" placeholder="Введите название" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="agentAuthor">Автор</label>
                                <input class="form-input" type="text" id="agentAuthor" name="agentAuthor" placeholder="Имя или команда" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="agentDescription">Краткое описание</label>
                                <textarea class="form-input" id="agentDescription" name="agentDescription" rows="3" placeholder="Опишите агента" required></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="agentLongDescription">Подробное описание</label>
                                <textarea class="form-input" id="agentLongDescription" name="agentLongDescription" rows="6" placeholder="Детальное описание возможностей, технологий и преимуществ" required></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="agentCategories">Категории</label>
                                <div class="dropdown-multiselect" id="dropdownCategories">
                                    <button type="button" class="dropdown-btn form-input" id="dropdownBtn">
                                        <span id="dropdownSelected">Выберите категории</span>
                                        <span class="dropdown-arrow">▼</span>
                                    </button>
                                    <div class="dropdown-list" id="dropdownList" style="display:none;">
                                        <label class="dropdown-option"><input type="checkbox" value="Программирование"> Программирование</label>
                                        <label class="dropdown-option"><input type="checkbox" value="Аналитика"> Аналитика</label>
                                        <label class="dropdown-option"><input type="checkbox" value="Дизайн"> Дизайн</label>
                                        <label class="dropdown-option"><input type="checkbox" value="Маркетинг"> Маркетинг</label>
                                        <label class="dropdown-option"><input type="checkbox" value="Образование"> Образование</label>
                                        <label class="dropdown-option"><input type="checkbox" value="Здоровье"> Здоровье</label>
                                        <label class="dropdown-option"><input type="checkbox" value="Финансы"> Финансы</label>
                                        <label class="dropdown-option"><input type="checkbox" value="Развлечения"> Развлечения</label>
                                        <label class="dropdown-option"><input type="checkbox" value="Другое"> Другое</label>
                                    </div>
                                    <input type="hidden" name="agentCategories" id="agentCategoriesHidden" required>
                                </div>
                                <small style="color:var(--text-tertiary);display:block;margin-top:0.5rem;">Выберите до 3 категорий</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="agentTags">Теги</label>
                                <input class="form-input" type="text" id="agentTags" name="agentTags" placeholder="Например: React, Python, Node.js" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="agentInstallGuide">Руководство по установке и запуску</label>
                                <textarea class="form-input" id="agentInstallGuide" name="agentInstallGuide" rows="5" placeholder="Инструкции для пользователей" required></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="agentRepo">Ссылка на репозиторий</label>
                                <input class="form-input" type="url" id="agentRepo" name="agentRepo" placeholder="https://github.com/your-agent">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="agentDemo">Демо/Видео (URL)</label>
                                <input class="form-input" type="url" id="agentDemo" name="agentDemo" placeholder="Ссылка на демо или видео">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="agentArchive">Загрузить архив агента (.zip)</label>
                                <input class="form-input" type="file" id="agentArchive" name="agentArchive" accept=".zip" required>
                                <small style="color:var(--text-tertiary);display:block;margin-top:0.5rem;">Загрузите архив с файлами агента (только .zip)</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="agentVideo">Загрузить видео демо (.mp4)</label>
                                <input class="form-input" type="file" id="agentVideo" name="agentVideo" accept="video/mp4" required>
                                <small style="color:var(--text-tertiary);display:block;margin-top:0.5rem;">Загрузите видео демо агента (только .mp4)</small>
                            </div>
                            <div class="form-group">
                                <button class="btn btn--primary btn--large" type="submit">Добавить агента</button>
                            </div>
                        </form>
                    </div>
                    <div class="agent-details-sidebar">
                        <div class="sidebar-widget">
                            <h3>Советы по добавлению агента</h3>
                            <ul>
                                <li>Заполните все поля максимально подробно.</li>
                                <li>Добавьте актуальные теги и категории.</li>
                                <li>Укажите корректные ссылки на репозиторий и демо.</li>
                                <li>Добавьте инструкцию по установке для пользователей.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </main>
            <footer class="main-footer">
                <div class="container footer-container">
                    <div class="footer-grid">
                        <div class="footer-about">
                            <div class="logo">
                                <div class="logo-icon">
                                    <img src="images/logos/Bot.svg" alt="AI Market Logo">
                                </div>
                                <span class="logo-title">AI Market</span>
                            </div>
                            <p class="footer-about-text">Лучший маркетплейс для аренды ИИ-агентов</p>
                        </div>
                        <div class="footer-links">
                            <h3 class="footer-heading">Для клиентов</h3>
                            <ul>
                                <li><a href="#">Как арендовать</a></li>
                                <li><a href="#">Гарантии</a></li>
                                <li><a href="#">Поддержка</a></li>
                            </ul>
                        </div>
                        <div class="footer-links">
                            <h3 class="footer-heading">Для разработчиков</h3>
                            <ul>
                                <li><a href="#">Разместить агента</a></li>
                                <li><a href="#">API документация</a></li>
                                <li><a href="#">Комиссии</a></li>
                            </ul>
                        </div>
                        <div class="footer-links">
                            <h3 class="footer-heading">Компания</h3>
                            <ul>
                                <li><a href="#">О нас</a></li>
                                <li><a href="#">Блог</a></li>
                                <li><a href="#">Контакты</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="footer-copyright">
                        © 2025 AI Market. Все права защищены.
                    </div>
                </div>
            </footer>
        </div>
    </div>
    <script src="js/main.js"></script>
    <script>
        // Dropdown multiselect logic
        const dropdownBtn = document.getElementById('dropdownBtn');
        const dropdownList = document.getElementById('dropdownList');
        const dropdownSelected = document.getElementById('dropdownSelected');
        const agentCategoriesHidden = document.getElementById('agentCategoriesHidden');
        dropdownBtn.addEventListener('click', function(e) {
            dropdownList.style.display = dropdownList.style.display === 'none' ? 'block' : 'none';
        });
        document.addEventListener('click', function(e) {
            if (!dropdownBtn.contains(e.target) && !dropdownList.contains(e.target)) {
                dropdownList.style.display = 'none';
            }
        });
        dropdownList.addEventListener('change', function() {
            const checked = Array.from(dropdownList.querySelectorAll('input[type=checkbox]:checked'));
            if (checked.length > 3) {
                checked[checked.length - 1].checked = false;
                return;
            }
            const values = checked.map(cb => cb.value);
            dropdownSelected.textContent = values.length ? values.join(', ') : 'Выберите категории';
            agentCategoriesHidden.value = values.join(', ');
        });
        document.getElementById('agentArchive').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            if (file.type !== 'application/zip' && !file.name.endsWith('.zip')) {
                alert('Можно загружать только .zip архивы');
                e.target.value = '';
                return;
            }
            // Автоматическая загрузка архива на сервер
            const formData = new FormData();
            formData.append('archive', file);
            fetch('/upload-agent-archive', {
                method: 'POST',
                body: formData
            })
            .then(res => res.ok ? res.text() : Promise.reject('Ошибка загрузки'))
            .then(msg => alert('Архив успешно загружен!'))
            .catch(err => alert('Ошибка: ' + err));
        });
        document.getElementById('agentVideo').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            if (file.type !== 'video/mp4' && !file.name.endsWith('.mp4')) {
                alert('Можно загружать только .mp4 видео');
                e.target.value = '';
                return;
            }
            // Автоматическая загрузка видео на сервер
            const formData = new FormData();
            formData.append('video', file);
            fetch('/upload-agent-video', {
                method: 'POST',
                body: formData
            })
            .then(res => res.ok ? res.text() : Promise.reject('Ошибка загрузки'))
            .then(msg => alert('Видео успешно загружено!'))
            .catch(err => alert('Ошибка: ' + err));
        });
    </script>
</body>
</html>
